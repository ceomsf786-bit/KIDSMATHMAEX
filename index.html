<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 16px;
        }

        .timer-display {
            background: rgba(255,255,255,0.2);
            padding: 15px 25px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 24px;
            font-weight: bold;
            letter-spacing: 2px;
        }

        .content {
            padding: 30px;
        }

        .quiz-selector {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 5px solid #667eea;
        }

        .quiz-selector label {
            display: block;
            font-weight: 600;
            margin-bottom: 15px;
            color: #2d3748;
            font-size: 18px;
        }

        .quiz-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .quiz-btn {
            padding: 15px 20px;
            background: white;
            border: 2px solid #667eea;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            font-weight: 600;
            color: #667eea;
            text-align: center;
        }

        .quiz-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .quiz-btn.active {
            background: #667eea;
            color: white;
        }

        .name-input-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 5px solid #667eea;
        }

        .name-input-section label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: #2d3748;
        }

        .name-input-section input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .name-input-section input:focus {
            outline: none;
            border-color: #667eea;
        }

        .question-container {
            margin-bottom: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 5px solid #667eea;
        }

        .question-number {
            color: #667eea;
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .question {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #2d3748;
        }

        .question-image {
            width: 100%;
            max-width: 500px;
            height: auto;
            margin-bottom: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: block;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option {
            padding: 15px 20px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .option:hover {
            border-color: #667eea;
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .option input[type="radio"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .option label {
            cursor: pointer;
            flex: 1;
            font-size: 16px;
        }

        .text-input {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            resize: vertical;
            transition: border-color 0.3s;
        }

        .text-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .text-answer-label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: #2d3748;
        }

        .exact-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: border-color 0.3s;
        }

        .exact-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .exact-input.correct {
            background: #d4edda;
            border-color: #28a745;
        }

        .exact-input.incorrect {
            background: #f8d7da;
            border-color: #dc3545;
        }

        .exact-answer-display {
            margin-top: 10px;
            padding: 10px 15px;
            background: #d4edda;
            border-left: 4px solid #28a745;
            border-radius: 8px;
            display: none;
        }

        .exact-answer-display.show {
            display: block;
        }

        .exact-answer-display strong {
            color: #155724;
        }

        .text-feedback {
            margin-top: 15px;
            padding: 15px;
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            border-radius: 8px;
            display: none;
        }

        .text-feedback.show {
            display: block;
        }

        .text-feedback h4 {
            color: #1976d2;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .text-feedback p {
            color: #424242;
            line-height: 1.6;
            margin: 0;
        }

        .option.correct {
            background: #d4edda;
            border-color: #28a745;
        }

        .option.incorrect {
            background: #f8d7da;
            border-color: #dc3545;
        }

        .button-container {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        button {
            padding: 15px 30px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 150px;
        }

        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .reset-btn {
            background: #6c757d;
            color: white;
        }

        .reset-btn:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .copy-btn {
            background: #28a745;
            color: white;
        }

        .copy-btn:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .copy-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .results {
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            text-align: center;
            display: none;
        }

        .results.show {
            display: block;
        }

        .score {
            font-size: 48px;
            font-weight: bold;
            margin: 20px 0;
        }

        .feedback {
            font-size: 18px;
            margin: 15px 0;
        }

        .explanation {
            margin-top: 15px;
            padding: 15px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            font-size: 14px;
            text-align: left;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            display: none;
            animation: slideIn 0.3s ease;
            z-index: 1000;
        }

        .toast.show {
            display: block;
        }

        .hidden {
            display: none;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @media (max-width: 600px) {
            .button-container {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }

            .quiz-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="toast" id="toast">Results copied to clipboard!</div>
    
    <div class="container">
        <div class="header">
            <h1 id="quizTitle">Multi-Quiz App</h1>
            <p id="quizSubtitle">Select a quiz to begin</p>
            <div class="timer-display hidden" id="timerDisplay">‚è±Ô∏è 00:00:00</div>
        </div>

        <div class="content">
            <div class="quiz-selector" id="quizSelector">
                <label>Choose a Quiz:</label>
                <div class="quiz-buttons" id="quizButtons"></div>
            </div>

            <div class="name-input-section hidden" id="nameSection">
                <label for="studentName">Enter Your Name:</label>
                <input type="text" id="studentName" placeholder="Your full name" autocomplete="name">
            </div>

            <div id="quizForm"></div>

            <div class="button-container hidden" id="actionButtons">
                <button type="button" class="submit-btn" onclick="submitQuiz()">Submit Quiz</button>
                <button type="button" class="reset-btn" onclick="resetQuiz()">Reset</button>
                <button type="button" class="copy-btn" id="copyBtn" onclick="copyResults()" disabled>Copy Results</button>
            </div>

            <div class="results" id="results">
                <h2>Quiz Results</h2>
                <div class="score" id="scoreDisplay"></div>
                <div class="feedback" id="feedback"></div>
                <div class="explanation" id="explanation"></div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // ADD YOUR QUIZZES HERE
        // ============================================
        
        const allQuizzes = [
            {
                title: "ADDITION & SUBTRACTION: 12.11.25",
                subtitle: "",
                mcqText: `

1. [EXACT] 1+1=  
[ANSWER: 2]  

2. [EXACT] 2+3=  
[ANSWER: 5]  

3. [EXACT] 4+5=  
[ANSWER: 9]  

4. [EXACT] 3+6=  
[ANSWER: 9]  

5. [EXACT] 7+2=  
[ANSWER: 9]  

6. [EXACT] 8+1=  
[ANSWER: 9]  

7. [EXACT] 5+4=  
[ANSWER: 9]  

8. [EXACT] 9+0=  
[ANSWER: 9]  

9. [EXACT] 6+3=  
[ANSWER: 9]  

10. [EXACT] 2+7=  
[ANSWER: 9]  

11. [EXACT] 9-1=  
[ANSWER: 8]  

12. [EXACT] 7-2=  
[ANSWER: 5]  

13. [EXACT] 8-5=  
[ANSWER: 3]  

14. [EXACT] 6-4=  
[ANSWER: 2]  

15. [EXACT] 5-3=  
[ANSWER: 2]  

16. [EXACT] 4-1=  
[ANSWER: 3]  

17. [EXACT] 9-8=  
[ANSWER: 1]  

18. [EXACT] 6-2=  
[ANSWER: 4]  

19. [EXACT] 3-1=  
[ANSWER: 2]  

20. [EXACT] 7-3=  
[ANSWER: 4]  

21. [EXACT] 1+6=  
[ANSWER: 7]  

22. [EXACT] 2+4=  
[ANSWER: 6]  

23. [EXACT] 5+2=  
[ANSWER: 7]  

24. [EXACT] 8+0=  
[ANSWER: 8]  

25. [EXACT] 9+1=  
[ANSWER: 10]  

26. [EXACT] 3+5=  
[ANSWER: 8]  

27. [EXACT] 4+4=  
[ANSWER: 8]  

28. [EXACT] 7-5=  
[ANSWER: 2]  

29. [EXACT] 8-3=  
[ANSWER: 5]  

30. [EXACT] 9-6=  
[ANSWER: 3]  



                `
            },
            {
                title: "MULTIPLY: 12.11.25",
                subtitle: "",
                mcqText: `

1. [EXACT] 1√ó1=  
[ANSWER: 1]  

2. [EXACT] 2√ó3=  
[ANSWER: 6]  

3. [EXACT] 4√ó5=  
[ANSWER: 20]  

4. [EXACT] 3√ó6=  
[ANSWER: 18]  

5. [EXACT] 7√ó2=  
[ANSWER: 14]  

6. [EXACT] 8√ó1=  
[ANSWER: 8]  

7. [EXACT] 5√ó4=  
[ANSWER: 20]  

8. [EXACT] 9√ó0=  
[ANSWER: 0]  

9. [EXACT] 6√ó3=  
[ANSWER: 18]  

10. [EXACT] 2√ó7=  
[ANSWER: 14]  

11. [EXACT] 9√ó1=  
[ANSWER: 9]  

12. [EXACT] 7√ó3=  
[ANSWER: 21]  

13. [EXACT] 8√ó2=  
[ANSWER: 16]  

14. [EXACT] 6√ó4=  
[ANSWER: 24]  

15. [EXACT] 5√ó5=  
[ANSWER: 25]  

16. [EXACT] 4√ó7=  
[ANSWER: 28]  

17. [EXACT] 9√ó2=  
[ANSWER: 18]  

18. [EXACT] 8√ó3=  
[ANSWER: 24]  

19. [EXACT] 6√ó6=  
[ANSWER: 36]  

20. [EXACT] 7√ó9=  
[ANSWER: 63]  

                `
            }
        ];
        
        // ============================================
        // END OF QUIZZES
        // ============================================

        let currentQuizIndex = null;
        let quizResults = null;
        let quizData = [];
        let timerInterval = null;
        let startTime = null;
        let elapsedSeconds = 0;

        function initializeApp() {
            const quizButtons = document.getElementById('quizButtons');
            quizButtons.innerHTML = '';
            
            allQuizzes.forEach((quiz, index) => {
                const btn = document.createElement('button');
                btn.className = 'quiz-btn';
                btn.textContent = quiz.title;
                btn.onclick = () => selectQuiz(index);
                quizButtons.appendChild(btn);
            });
        }

        function selectQuiz(index) {
            currentQuizIndex = index;
            const selectedQuiz = allQuizzes[index];
            
            document.getElementById('quizTitle').textContent = selectedQuiz.title;
            document.getElementById('quizSubtitle').textContent = selectedQuiz.subtitle;
            
            document.getElementById('nameSection').classList.remove('hidden');
            document.getElementById('actionButtons').classList.remove('hidden');
            document.getElementById('timerDisplay').classList.remove('hidden');
            
            const buttons = document.querySelectorAll('.quiz-btn');
            buttons.forEach((btn, i) => {
                if (i === index) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            generateQuiz(selectedQuiz.mcqText);
        }

        function startTimer() {
            startTime = Date.now();
            timerInterval = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            const now = Date.now();
            elapsedSeconds = Math.floor((now - startTime) / 1000);
            
            const hours = Math.floor(elapsedSeconds / 3600);
            const minutes = Math.floor((elapsedSeconds % 3600) / 60);
            const seconds = elapsedSeconds % 60;
            
            const timeString = `‚è±Ô∏è ${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            document.getElementById('timerDisplay').textContent = timeString;
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function formatElapsedTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            
            if (hours > 0) {
                return `${hours}h ${minutes}m ${secs}s`;
            } else if (minutes > 0) {
                return `${minutes}m ${secs}s`;
            } else {
                return `${secs}s`;
            }
        }

        function parseMCQText(text) {
            const questions = [];
            const lines = text.trim().split('\n').filter(line => line.trim());
            
            let currentQuestion = null;
            let currentOptions = [];
            let correctIndex = -1;
            let optionCount = 0;
            let titleLine = '';
            let currentImage = null;
            let isTextQuestion = false;
            let currentFeedback = null;
            let isExactQuestion = false;
            let currentExactAnswer = null;
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                if (i === 0 && !line.match(/^\d+\./)) {
                    titleLine = line;
                    continue;
                }
                
                const imageMatch = line.match(/^\[IMAGE:\s*(.+)\]$/i);
                if (imageMatch) {
                    currentImage = imageMatch[1].trim();
                    continue;
                }
                
                const feedbackMatch = line.match(/^\[FEEDBACK\]\s*(.+)/i);
                if (feedbackMatch) {
                    currentFeedback = feedbackMatch[1];
                    continue;
                }
                
                const answerMatch = line.match(/^\[ANSWER:\s*(.+)\]$/i);
                if (answerMatch) {
                    currentExactAnswer = answerMatch[1].trim();
                    continue;
                }
                
                const questionMatch = line.match(/^(\d+)\.\s*(.+)/);
                if (questionMatch) {
                    if (currentQuestion && (currentOptions.length > 0 || isTextQuestion || isExactQuestion)) {
                        questions.push({
                            question: currentQuestion,
                            options: (isTextQuestion || isExactQuestion) ? [] : currentOptions,
                            correct: correctIndex,
                            image: null,
                            isText: isTextQuestion,
                            isExact: isExactQuestion,
                            exactAnswer: currentExactAnswer,
                            feedback: currentFeedback
                        });
                    }
                    
                    const questionText = questionMatch[2];
                    const textMatch = questionText.match(/^\[TEXT\]\s*(.+)/i);
                    const exactMatch = questionText.match(/^\[EXACT\]\s*(.+)/i);
                    
                    if (textMatch) {
                        currentQuestion = textMatch[1];
                        currentOptions = [];
                        correctIndex = -1;
                        optionCount = 0;
                        isTextQuestion = true;
                        isExactQuestion = false;
                        currentFeedback = null;
                        currentExactAnswer = null;
                    } else if (exactMatch) {
                        currentQuestion = exactMatch[1];
                        currentOptions = [];
                        correctIndex = -1;
                        optionCount = 0;
                        isTextQuestion = false;
                        isExactQuestion = true;
                        currentFeedback = null;
                        currentExactAnswer = null;
                    } else {
                        currentQuestion = questionText;
                        currentOptions = [];
                        correctIndex = -1;
                        optionCount = 0;
                        isTextQuestion = false;
                        isExactQuestion = false;
                        currentFeedback = null;
                        currentExactAnswer = null;
                    }
                    continue;
                }
                
                if (!isTextQuestion && !isExactQuestion) {
                    const optionMatch = line.match(/^([A-Za-z])\)\s*(.+)/);
                    if (optionMatch && currentQuestion) {
                        let optionText = optionMatch[2];
                        
                        const isBold = optionText.includes('**') || optionText.includes('***');
                        const isUppercase = optionText === optionText.toUpperCase() && 
                                           optionText !== optionText.toLowerCase() &&
                                           !optionText.includes('**');
                        const hasCorrectMarker = optionText.toUpperCase().includes('[CORRECT]') || 
                                                optionText.toUpperCase().includes('(CORRECT)');
                        
                        if (isBold || hasCorrectMarker) {
                            correctIndex = optionCount;
                            optionText = optionText.replace(/\*\*/g, '').replace(/\*\*\*/g, '')
                                                  .replace(/\[CORRECT\]/gi, '').replace(/\(CORRECT\)/gi, '').trim();
                        } else if (isUppercase && optionText.length > 3) {
                            correctIndex = optionCount;
                        }
                        
                        currentOptions.push(optionText);
                        optionCount++;
                    }
                }
            }
            
            if (currentQuestion && (currentOptions.length > 0 || isTextQuestion || isExactQuestion)) {
                questions.push({
                    question: currentQuestion,
                    options: (isTextQuestion || isExactQuestion) ? [] : currentOptions,
                    correct: correctIndex,
                    image: currentImage,
                    isText: isTextQuestion,
                    isExact: isExactQuestion,
                    exactAnswer: currentExactAnswer,
                    feedback: currentFeedback
                });
            }
            
            let pendingImage = null;
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                const imageMatch = line.match(/^\[IMAGE:\s*(.+)\]$/i);
                
                if (imageMatch) {
                    pendingImage = imageMatch[1].trim();
                } else if (line.match(/^\d+\.\s*(.+)/)) {
                    const questionMatch = line.match(/^\d+\.\s*(.+)/);
                    let qText = questionMatch[1];
                    
                    const textMatch = qText.match(/^\[TEXT\]\s*(.+)/i);
                    if (textMatch) {
                        qText = textMatch[1];
                    }
                    
                    const exactMatch = qText.match(/^\[EXACT\]\s*(.+)/i);
                    if (exactMatch) {
                        qText = exactMatch[1];
                    }
                    
                    const foundQ = questions.find(q => q.question === qText);
                    if (foundQ && pendingImage) {
                        foundQ.image = pendingImage;
                        pendingImage = null;
                    }
                }
            }
            
            return { title: titleLine, questions: questions };
        }

        function generateQuiz(mcqText) {
            const parsed = parseMCQText(mcqText);
            quizData = parsed.questions;
            
            const quizForm = document.getElementById('quizForm');
            let html = '';

            quizData.forEach((q, index) => {
                const qNum = index + 1;
                const qId = `q${qNum}`;
                
                html += `
                    <div class="question-container">
                        <div class="question-number">Question ${qNum} of ${quizData.length}</div>`;
                
                if (q.image) {
                    html += `<img src="${q.image}" alt="Question ${qNum} image" class="question-image" onerror="this.style.display='none'">`;
                }
                
                html += `<div class="question">${q.question}</div>`;
                
                if (q.isText) {
                    html += `
                        <label class="text-answer-label" for="${qId}_text">Your Answer:</label>
                        <textarea class="text-input" id="${qId}_text" name="${qId}" placeholder="Type your answer here..."></textarea>
                        <div class="text-feedback" id="${qId}_feedback"></div>`;
                } else if (q.isExact) {
                    html += `
                        <label class="text-answer-label" for="${qId}_exact">Your Answer:</label>
                        <input type="text" class="exact-input" id="${qId}_exact" name="${qId}" placeholder="Type your answer here...">
                        <div class="exact-answer-display" id="${qId}_exact_answer"></div>`;
                } else {
                    html += `<div class="options">`;
                    
                    q.options.forEach((option, optIndex) => {
                        const optId = `${qId}_${optIndex}`;
                        html += `
                            <div class="option" onclick="selectOption(this, '${qId}', ${optIndex})">
                                <input type="radio" name="${qId}" value="${optIndex}" id="${optId}">
                                <label for="${optId}">${option}</label>
                            </div>`;
                    });
                    
                    html += `</div>`;
                }
                
                html += `</div>`;
            });

            quizForm.innerHTML = html;
            
            stopTimer();
            elapsedSeconds = 0;
            startTimer();
            
            document.getElementById('results').classList.remove('show');
            document.getElementById('copyBtn').disabled = true;
        }

        function selectOption(element, questionName, value) {
            const radio = document.getElementById(`${questionName}_${value}`);
            radio.checked = true;
        }

        function submitQuiz() {
            if (currentQuizIndex === null) {
                alert('Please select a quiz first.');
                return;
            }

            const studentName = document.getElementById('studentName').value.trim();
            
            if (!studentName) {
                alert('Please enter your name before submitting.');
                document.getElementById('studentName').focus();
                return;
            }

            stopTimer();
            const timeTaken = elapsedSeconds;

            let score = 0;
            let totalQuestions = quizData.length;
            let detailedResults = [];

            quizData.forEach((q, index) => {
                const qNum = index + 1;
                const qId = `q${qNum}`;
                
                if (q.isText) {
                    const textInput = document.getElementById(`${qId}_text`);
                    const textAnswer = textInput ? textInput.value.trim() : '';
                    
                    if (q.feedback) {
                        const feedbackDiv = document.getElementById(`${qId}_feedback`);
                        if (feedbackDiv) {
                            feedbackDiv.innerHTML = `<h4>üí° Sample Answer / Points to Consider:</h4><p>${q.feedback}</p>`;
                            feedbackDiv.classList.add('show');
                        }
                    }
                    
                    detailedResults.push({
                        question: q.question,
                        answer: textAnswer || "No answer provided",
                        feedback: q.feedback || null,
                        isText: true,
                        isExact: false
                    });
                } else if (q.isExact) {
                    const exactInput = document.getElementById(`${qId}_exact`);
                    const userAnswer = exactInput ? exactInput.value.trim() : '';
                    const correctAnswer = q.exactAnswer || '';
                    
                    const normalizedUser = userAnswer.toLowerCase().trim();
                    const normalizedCorrect = correctAnswer.toLowerCase().trim();
                    const isCorrect = normalizedUser === normalizedCorrect;
                    
                    if (isCorrect) {
                        score++;
                        exactInput.classList.add('correct');
                    } else {
                        exactInput.classList.add('incorrect');
                    }
                    
                    const answerDisplay = document.getElementById(`${qId}_exact_answer`);
                    if (answerDisplay) {
                        answerDisplay.innerHTML = `<strong>Correct Answer:</strong> ${correctAnswer}`;
                        answerDisplay.classList.add('show');
                        answerDisplay.classList.add('show');
                    }

                    detailedResults.push({
                        question: q.question,
                        userAnswer: userAnswer || "No answer provided",
                        correctAnswer: correctAnswer,
                        isCorrect: isCorrect,
                        isExact: true,
                        isText: false
                    });

                } else {
                    // Multiple Choice Questions
                    const selectedOption = document.querySelector(`input[name="${qId}"]:checked`);
                    const selectedIndex = selectedOption ? parseInt(selectedOption.value) : null;

                    const options = document.querySelectorAll(`input[name="${qId}"]`);
                    options.forEach((opt, i) => {
                        const optionDiv = opt.closest('.option');
                        if (i === q.correct) {
                            optionDiv.classList.add('correct');
                        }
                        if (selectedIndex === i && i !== q.correct) {
                            optionDiv.classList.add('incorrect');
                        }
                    });

                    if (selectedIndex === q.correct) score++;

                    detailedResults.push({
                        question: q.question,
                        selected: selectedIndex !== null ? q.options[selectedIndex] : "No answer selected",
                        correct: q.options[q.correct] || "N/A",
                        isCorrect: selectedIndex === q.correct,
                        isText: false,
                        isExact: false
                    });
                }
            });

            const percentage = Math.round((score / totalQuestions) * 100);
            const feedback =
                percentage >= 90 ? "üåü Excellent!" :
                percentage >= 70 ? "üëç Good job!" :
                percentage >= 50 ? "üôÇ Fair effort!" :
                "üòï Needs improvement.";

            const resultsDiv = document.getElementById('results');
            const scoreDisplay = document.getElementById('scoreDisplay');
            const feedbackDisplay = document.getElementById('feedback');
            const explanationDisplay = document.getElementById('explanation');
            const copyBtn = document.getElementById('copyBtn');

            scoreDisplay.textContent = `${score}/${totalQuestions} (${percentage}%)`;
            feedbackDisplay.textContent = feedback;

            let explanationHTML = `
                <strong>Name:</strong> ${studentName}<br>
                <strong>Quiz:</strong> ${allQuizzes[currentQuizIndex].title}<br>
                <strong>Time Taken:</strong> ${formatElapsedTime(timeTaken)}<br><br>
                <h3>Detailed Results:</h3>
            `;

            detailedResults.forEach((r, i) => {
                explanationHTML += `<p><strong>Q${i + 1}:</strong> ${r.question}<br>`;
                if (r.isText) {
                    explanationHTML += `<em>Your answer:</em> ${r.answer}<br>`;
                    if (r.feedback) explanationHTML += `<em>Sample:</em> ${r.feedback}<br>`;
                } else if (r.isExact) {
                    explanationHTML += `<em>Your answer:</em> ${r.userAnswer}<br>`;
                    explanationHTML += `<em>Correct answer:</em> ${r.correctAnswer}<br>`;
                    explanationHTML += `<em>Result:</em> ${r.isCorrect ? '‚úÖ Correct' : '‚ùå Incorrect'}<br>`;
                } else {
                    explanationHTML += `<em>Your answer:</em> ${r.selected}<br>`;
                    explanationHTML += `<em>Correct answer:</em> ${r.correct}<br>`;
                    explanationHTML += `<em>Result:</em> ${r.isCorrect ? '‚úÖ Correct' : '‚ùå Incorrect'}<br>`;
                }
                explanationHTML += `</p>`;
            });

            explanationDisplay.innerHTML = explanationHTML;
            resultsDiv.classList.add('show');
            copyBtn.disabled = false;

            quizResults = {
                studentName,
                score,
                totalQuestions,
                percentage,
                feedback,
                timeTaken,
                detailedResults
            };
        }

        function resetQuiz() {
            stopTimer();
            document.getElementById('quizForm').innerHTML = '';
            document.getElementById('results').classList.remove('show');
            document.getElementById('nameSection').classList.add('hidden');
            document.getElementById('timerDisplay').classList.add('hidden');
            document.getElementById('actionButtons').classList.add('hidden');
            document.getElementById('quizTitle').textContent = "Multi-Quiz App";
            document.getElementById('quizSubtitle').textContent = "Select a quiz to begin";
            document.getElementById('studentName').value = '';
            document.getElementById('copyBtn').disabled = true;

            const buttons = document.querySelectorAll('.quiz-btn');
            buttons.forEach(btn => btn.classList.remove('active'));

            currentQuizIndex = null;
            elapsedSeconds = 0;
            document.getElementById('timerDisplay').textContent = '‚è±Ô∏è 00:00:00';
        }

        function copyResults() {
            if (!quizResults) return;

            let output = `üìò Quiz Results\n`;
            output += `Name: ${quizResults.studentName}\n`;
            output += `Quiz: ${allQuizzes[currentQuizIndex].title}\n`;
            output += `Score: ${quizResults.score}/${quizResults.totalQuestions} (${quizResults.percentage}%)\n`;
            output += `Feedback: ${quizResults.feedback}\n`;
            output += `Time Taken: ${formatElapsedTime(quizResults.timeTaken)}\n\n`;

            quizResults.detailedResults.forEach((r, i) => {
                output += `Q${i + 1}: ${r.question}\n`;
                if (r.isText) {
                    output += `Your answer: ${r.answer}\n`;
                    if (r.feedback) output += `Sample: ${r.feedback}\n`;
                } else if (r.isExact) {
                    output += `Your answer: ${r.userAnswer}\n`;
                    output += `Correct answer: ${r.correctAnswer}\n`;
                    output += `Result: ${r.isCorrect ? 'Correct ‚úÖ' : 'Incorrect ‚ùå'}\n`;
                } else {
                    output += `Your answer: ${r.selected}\n`;
                    output += `Correct answer: ${r.correct}\n`;
                    output += `Result: ${r.isCorrect ? 'Correct ‚úÖ' : 'Incorrect ‚ùå'}\n`;
                }
                output += `\n`;
            });

            navigator.clipboard.writeText(output)
                .then(() => showToast())
                .catch(() => alert('Unable to copy results. Please copy manually.'));
        }

        function showToast() {
            const toast = document.getElementById('toast');
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        window.onload = initializeApp;
    </script>
</body>
</html>

