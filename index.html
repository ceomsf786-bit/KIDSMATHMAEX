<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dynamic Math Quiz</title>

<style>
/* your existing CSS unchanged */
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);min-height:100vh;padding:20px;}
.container{max-width:800px;margin:0 auto;background:white;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,0.3);overflow:hidden;}
.header{background:linear-gradient(135deg,#667eea,#764ba2);color:white;padding:30px;text-align:center;}
.timer-display{background:rgba(255,255,255,0.2);padding:15px 25px;border-radius:10px;margin-top:20px;font-size:24px;font-weight:bold;letter-spacing:2px;}
.content{padding:30px;}
.quiz-selector,.name-input-section,.question-container{margin-bottom:30px;padding:20px;background:#f8f9fa;border-radius:15px;border-left:5px solid #667eea;}
.quiz-selector label,.name-input-section label{font-weight:600;margin-bottom:15px;display:block;color:#2d3748;font-size:18px;}
.quiz-buttons{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:10px;}
.quiz-btn{padding:12px;background:white;border:2px solid #667eea;border-radius:10px;cursor:pointer;transition:0.3s;font-size:16px;font-weight:600;color:#667eea;text-align:center;}
.quiz-btn:hover{background:#667eea;color:white;transform:translateY(-2px);}
.quiz-btn.active{background:#667eea;color:white;}
.name-input-section input{width:100%;padding:12px;border:2px solid #e2e8f0;border-radius:10px;font-size:16px;}
.name-input-section input:focus{outline:none;border-color:#667eea;}
.question-number{color:#667eea;font-weight:bold;font-size:14px;margin-bottom:10px;}
.question{font-size:18px;font-weight:600;margin-bottom:20px;color:#2d3748;}
.exact-input{width:100%;padding:15px;border:2px solid #e2e8f0;border-radius:10px;font-size:16px;}
.exact-input.correct{background:#d4edda;border-color:#28a745;}
.exact-input.incorrect{background:#f8d7da;border-color:#dc3545;}
.exact-answer-display{margin-top:10px;padding:10px;background:#d4edda;border-left:4px solid #28a745;border-radius:8px;display:none;}
.exact-answer-display.show{display:block;}
.button-container{display:flex;gap:15px;margin-top:30px;flex-wrap:wrap;}
button{padding:15px;font-size:16px;font-weight:600;border:none;border-radius:10px;cursor:pointer;transition:0.3s;flex:1;min-width:150px;}
.submit-btn{background:linear-gradient(135deg,#667eea,#764ba2);color:white;}
.reset-btn{background:#6c757d;color:white;}
.copy-btn{background:#28a745;color:white;}
.results{margin-top:30px;padding:25px;background:linear-gradient(135deg,#667eea,#764ba2);color:white;border-radius:15px;text-align:center;display:none;}
.results.show{display:block;}
.hidden{display:none;}
</style>
</head>

<body>

<div class="container">
  <div class="header">
    <h1 id="quizTitle">Dynamic Math Quiz</h1>
    <div class="timer-display hidden" id="timerDisplay">‚è±Ô∏è 00:00:00</div>
  </div>

  <div class="content">

    <!-- QUIZ SELECTOR -->
    <div class="quiz-selector" id="quizSelector">
      <label>Select Quiz Type:</label>
      <div class="quiz-buttons">
        <button class="quiz-btn" onclick="startQuiz('add')">Addition (+)</button>
        <button class="quiz-btn" onclick="startQuiz('subtract')">Subtraction (‚àí)</button>
        <button class="quiz-btn" onclick="startQuiz('multiply')">Multiplication (√ó)</button>
        <button class="quiz-btn" onclick="startQuiz('divide')">Division (√∑)</button>
        <button class="quiz-btn" onclick="startQuiz('mixed')">Mixed</button>
      </div>
    </div>

    <!-- NAME -->
    <div class="name-input-section" id="nameSection">
      <label for="studentName">Enter Your Name:</label>
      <input type="text" id="studentName" placeholder="Your full name">
    </div>

    <div id="quizForm"></div>

    <!-- BUTTONS -->
    <div class="button-container">
      <button class="submit-btn" onclick="submitQuiz()">Submit Quiz</button>
      <button class="reset-btn" onclick="resetQuiz()">Reset</button>
      <button class="copy-btn" id="copyBtn" onclick="copyResults()" disabled>Copy Results</button>
    </div>

    <!-- RESULTS -->
    <div class="results" id="results">
      <h2>Quiz Results</h2>
      <div id="scoreDisplay"></div>
      <div id="feedback"></div>
      <div id="explanation"></div>
    </div>

  </div>
</div>

<script>
let quizData = [];
let elapsedSeconds = 0;
let timerInterval = null;
let currentQuizType = "mixed";

const GOOGLE_SHEET_API = "https://script.google.com/macros/s/AKfycbyK53ZXPHkXNMTCTN8gs1LlM7D9JFCw2zzqL5ro0RnUv5iOwer6tdNUfR-DxX4JTr8/exec"; 

// üü¢ Generate Questions
function generateRandomQuestions() {
  let types = currentQuizType === "mixed" ? ["add","subtract","multiply","divide"] : [currentQuizType];
  const questions = [];

  for (let i = 0; i < 20; i++) {
    const type = types[Math.floor(Math.random() * types.length)];
    const a = Math.floor(Math.random() * 12) + 1;
    const b = Math.floor(Math.random() * 12) + 1;

    let questionText;
    let storedQuestion;
    let answer;

    if (type === "add") {
      questionText = `${a} + ${b} = ?`;
      storedQuestion = `${a} + ${b}`;
      answer = a + b;
    }
    else if (type === "subtract") {
      questionText = `${a} - ${b} = ?`;
      storedQuestion = `${a} - ${b}`;
      answer = a - b;
    }
    else if (type === "multiply") {
      questionText = `${a} √ó ${b} = ?`;
      storedQuestion = `${a} x ${b}`;
      answer = a * b;
    }
    else if (type === "divide") {
      const product = a * b;
      questionText = `${product} √∑ ${a} = ?`;
      storedQuestion = `${product} / ${a}`;
      answer = b;
    }

    questions.push({ display: questionText, question: storedQuestion, exactAnswer: answer.toString() });
  }
  return questions;
}

// üü¢ Display Quiz
function displayQuiz() {
  quizData = generateRandomQuestions();
  const form = document.getElementById("quizForm");

  form.innerHTML = "";

  quizData.forEach((q, i) => {
    form.innerHTML += `
      <div class="question-container">
        <div class="question-number">Question ${i + 1}</div>
        <div class="question" id="qtext${i}"></div>
        <input type="number" class="exact-input" id="q${i}" inputmode="numeric" placeholder="Enter number">
        <div class="exact-answer-display" id="q${i}_ans"></div>
      </div>`;
  });

  // Fill question text WITHOUT HTML interpretation
  quizData.forEach((q, i) => {
    document.getElementById(`qtext${i}`).textContent = q.display;
  });

  startTimer();
}

// üü¢ Timer
function startTimer() {
  elapsedSeconds = 0;
  document.getElementById("timerDisplay").classList.remove("hidden");
  timerInterval = setInterval(() => {
    elapsedSeconds++;
    const m = String(Math.floor(elapsedSeconds / 60)).padStart(2,"0");
    const s = String(elapsedSeconds % 60).padStart(2,"0");
    document.getElementById("timerDisplay").textContent = `‚è±Ô∏è 00:${m}:${s}`;
  }, 1000);
}

// üü¢ Submit to Google Sheets
function submitQuizToSheet(name, totalScore, quizData) {
  const payload = {
    timestamp: new Date().toISOString(),
    name,
    totalScore,
    answers: quizData.map((q, i) => ({
      question: q.question,
      userAnswer: document.getElementById(`q${i}`).value.trim(),
      correctAnswer: q.exactAnswer,
      isCorrect: document.getElementById(`q${i}`).value.trim() === q.exactAnswer ? "YES" : "NO"
    }))
  };

  fetch(GOOGLE_SHEET_API, {
    method: "POST",
    body: JSON.stringify(payload)
  });
}

// üü¢ Submit Quiz
function submitQuiz() {
  const name = document.getElementById("studentName").value.trim();
  if (!name) return alert("Enter your name");

  clearInterval(timerInterval);

  let score = 0;

  quizData.forEach((q,i)=>{
    const user = document.getElementById(`q${i}`).value.trim();
    const box = document.getElementById(`q${i}`);
    const ansDiv = document.getElementById(`q${i}_ans`);

    if(user === q.exactAnswer){
      score++;
      box.classList.add("correct");
    } else {
      box.classList.add("incorrect");
    }

    ansDiv.textContent = "Correct Answer: " + q.exactAnswer;
    ansDiv.classList.add("show");
  });

  const pct = Math.round((score / quizData.length) * 100);
  document.getElementById("scoreDisplay").textContent = `${score}/20 (${pct}%)`;
  document.getElementById("feedback").textContent =
      pct >= 80 ? "Excellent!" : pct >= 60 ? "Good!" : "Keep practising!";
  document.getElementById("explanation").innerHTML =
      `Name: ${name}<br>Time: ${elapsedSeconds}s<br>Mode: ${currentQuizType}`;

  document.getElementById("results").classList.add("show");
  document.getElementById("copyBtn").disabled = false;

  // SEND TO GOOGLE SHEETS
  submitQuizToSheet(name, score, quizData);
}

function resetQuiz() {
  document.getElementById("results").classList.remove("show");
  document.getElementById("copyBtn").disabled = true;
  displayQuiz();
}

function copyResults() {
  alert("Results copied!");
}

function startQuiz(type){
  currentQuizType = type;
  document.querySelectorAll(".quiz-btn").forEach(btn=>btn.classList.remove("active"));
  event.target.classList.add("active");
  displayQuiz();
}

displayQuiz();
</script>
</body>
</html>
